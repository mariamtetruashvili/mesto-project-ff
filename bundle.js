(()=>{"use strict";var e={};function t(e,t,r,n,o,a){const c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),s=c.querySelector(".card__image"),i=c.querySelector(".card__title"),l=c.querySelector(".card__delete-button"),u=c.querySelector(".card__like-button"),d=c.querySelector(".card__like-counter");return s.src=e.link,s.alt=e.name,i.textContent=e.name,d.textContent=e.likes?.length||0,function(e,t){return Array.isArray(e.likes)&&e.likes.some((e=>e._id===t))}(e,t)&&u.classList.add("card__like-button_is-active"),t!==r?l.remove():l.addEventListener("click",(t=>{t.stopPropagation(),n(e._id,c)})),s.addEventListener("click",(()=>a(e.name,e.link))),u.addEventListener("click",(()=>{o(e._id,u,d)})),c}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");e&&n(e)}}function a(e,t,r,n){const o=e.querySelector(`#${t.id}-error`);o&&(t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass))}function c(e,t,r){return t.validity.valid?(function(e,t,r){const n=e.querySelector(`#${t.id}-error`);n&&(t.classList.remove(r.inputErrorClass),n.textContent="",n.classList.remove(r.errorClass))}(e,t,r),!0):t.validity.valueMissing?(a(e,t,t.dataset.errorRequired||t.validationMessage,r),!1):t.validity.patternMismatch?(a(e,t,t.dataset.errorPattern||t.validationMessage,r),!1):t.validity.tooShort||t.validity.tooLong?(a(e,t,t.dataset.errorLength||t.validationMessage,r),!1):"url"!==t.type||t.validity.valid?(a(e,t,t.validationMessage,r),!1):(a(e,t,t.dataset.errorUrl||t.validationMessage,r),!1)}function s(e,t){const r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);if(!n)return;const o=r.every((r=>""!==r.value.trim()&&c(e,r,t)));n.disabled=!o,n.classList.toggle(t.inactiveButtonClass,!o)}function i(e,t){const r=e.querySelectorAll(t.inputSelector),n=e.querySelector(t.submitButtonSelector);r.forEach((r=>{const n=e.querySelector(`#${r.id}-error`);n&&(n.textContent=""),r.classList.remove(t.inputErrorClass)})),n&&(n.disabled=!0,n.classList.add(t.inactiveButtonClass))}e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var r=e.g.document;if(!t&&r&&(r.currentScript&&"SCRIPT"===r.currentScript.tagName.toUpperCase()&&(t=r.currentScript.src),!t)){var n=r.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!t||!/^http(s?):/.test(t));)t=n[o--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),e.p,e.p;const l={baseUrl:"https://nomoreparties.co/v1/wff-cohort-39",headers:{authorization:"a937dc3d-a867-499c-a146-3d115cd1c807","Content-Type":"application/json"}};function u(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}function d(e){return fetch(`${l.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:l.headers}).then(u)}function p(e){return fetch(`${l.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:l.headers}).then(u)}const m=document.querySelector(".places__list"),_=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_new-card"),h=document.querySelector(".profile__title"),f=document.querySelector(".profile__description"),v=document.querySelector(".popup_type_edit .popup__form"),S=v.querySelector(".popup__input_type_name"),b=v.querySelector(".popup__input_type_description"),q=document.querySelector(".profile__title"),g=document.querySelector(".profile__image"),k=document.querySelector(".profile__edit-button"),E=document.querySelector(".popup_type_edit"),C=document.forms["edit-profile"],L=y.querySelector(".popup__form"),x=L.querySelector(".popup__input_type_card-name"),$=L.querySelector(".popup__input_type_url"),w=document.querySelector(".popup_type_edit-avatar"),T=w.querySelector("form"),A=T.querySelector('input[name="avatar"]'),U=T.querySelector('button[type="submit"]'),j=document.querySelector(".profile__avatar-edit-icon"),P=document.querySelector(".places__list"),D=document.querySelector(".popup_type_image"),M=D.querySelector(".popup__image"),B=D.querySelector(".popup__caption"),N=document.querySelector(".popup_type_delete-confirm"),O=N.querySelector('[name="confirm-delete"]');function H(e,t){M.src=t,M.alt=e,B.textContent=e,r(D)}document.querySelector(".profile__edit-button").addEventListener("click",(()=>{S.value=h.textContent,b.value=f.textContent,r(_)})),document.querySelector(".profile__add-button").addEventListener("click",(()=>{r(y)})),document.querySelectorAll(".popup__close").forEach((e=>{e.addEventListener("click",(()=>{n(e.closest(".popup"))}))})),document.querySelectorAll(".popup").forEach((e=>{e.addEventListener("mousedown",(t=>{t.target.classList.contains("popup")&&n(e)}))})),[{name:"Архыз",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg"},{name:"Челябинская область",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg"},{name:"Иваново",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg"},{name:"Камчатка",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg"},{name:"Холмогорский район",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg"},{name:"Байкал",link:"https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg"}].forEach((e=>{const r=t(e,F,R,H);m.append(r)}));const I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function J(e){q.textContent=e.name,f.textContent=e.about,g.style.backgroundImage=`url('${e.avatar}')`}!function(e){document.querySelectorAll(e.formSelector).forEach((t=>{t.addEventListener("submit",(e=>e.preventDefault())),function(e,t){e.querySelectorAll(t.inputSelector).forEach((r=>{r.addEventListener("input",(()=>{c(e,r,t),s(e,t)})),r.addEventListener("blur",(()=>{c(e,r,t)}))})),s(e,t)}(t,e)}))}(I),k.addEventListener("click",(function(){C.elements.name.value=q.textContent,C.elements.description.value=f.textContent,i(C,I),r(E)})),C.addEventListener("submit",(function(e){e.preventDefault();const t=C.querySelector(".popup__button");var r,o;t.textContent="Сохранение...",(r=C.elements.name.value,o=C.elements.description.value,fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:r,about:o})}).then(u)).then((e=>{J(e),n(E)})).catch((e=>console.error("Ошибка при обновлении профиля:",e))).finally((()=>{t.textContent="Сохранить"}))})),L.addEventListener("submit",(function(e){e.preventDefault();const r=e.target.querySelector("button[type='submit']"),o=x.value.trim(),a=$.value.trim();o&&a?(r.textContent="Сохранение...",function(e,t){return fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(u)}(o,a).then((e=>{const r=t(e,z,e.owner._id,F,((e,t,r)=>R(e,t,r)),H);P.prepend(r),n(y),L.reset(),i(L,I)})).catch((e=>console.error("Ошибка при добавлении карточки:",e))).finally((()=>{r.textContent="Сохранить"}))):console.error("Название и ссылка обязательны")}));let z="";function R(e,t,r){const n=t.classList.contains("card__like-button_is-active");(n?p:d)(e).then((e=>{r.textContent=e.likes.length,t.classList.toggle("card__like-button_is-active",!n)})).catch((e=>{console.error("Ошибка при изменении лайка:",e)}))}function F(e,t){r(N),O.onsubmit=r=>{r.preventDefault(),function(e){return fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(u)}(e).then((()=>{t.remove(),n(N)})).catch((e=>{console.error("Ошибка при удалении карточки:",e)}))}}document.addEventListener("DOMContentLoaded",(()=>{Promise.all([fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(u),fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(u)]).then((e=>{let[r,n]=e;z=r._id,J(r),function(e){P.innerHTML="",e.forEach((e=>{const r=t(e,z,e.owner._id,F,R,H);P.appendChild(r)}))}(n)})).catch((e=>console.error("Ошибка при загрузке данных:",e)))})),T.addEventListener("submit",(e=>{e.preventDefault();const t=A.value;var r;(r=t,fetch(r,{method:"HEAD"}).then((e=>{if(!e.ok)throw new Error(`Сервер вернул статус: ${e.status}`);const t=e.headers.get("Content-Type");if(!t||!t.startsWith("image/"))throw new Error(`Ссылка не ведёт на изображение (Content-Type: ${t})`);return!0}))).then((()=>{return U.textContent="Сохранение...",e=t,fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(u);var e})).then((e=>{g.style.backgroundImage=`url(${e.avatar})`,n(w),T.reset(),i(T,I)})).catch((e=>{console.error("Ошибка при проверке или обновлении:",e),showError("avatar-url",e.message||"Ошибка при валидации ссылки")})).finally((()=>{U.textContent="Сохранить"}))})),j.addEventListener("click",(()=>r(w)))})();